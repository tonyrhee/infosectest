## 정보처리기사 실기

## Chapter4. 데이터 조작 프로시저 최적화

## 01. 데이터 조작 프로시저 성능 개선

<hr>

### 쿼리 성능 개선

쿼리 성능 개선은 데이터베이스에서 프로시저에 있는 SQL 실행 계획을 분석, 수정을 통해 최소의 시간으로 원하는 결과를 얻도록 프로시저를 수정하는 작업이다.

- SQL 성능 개선을 통해 데이터 조작 프로시저의 성능 개선이 가능하다.

**✔ 쿼리 성능 개선 절차**

```
문제 있는 SQL 식별

옵티마이저 통계 확인

SQL문 재구성

인덱스 재구성

실행계획 유지관리
```

### 옵티마이저

SQL을 가장 빠르고 효율적으로 수행할 **최적의 처리 경로**를 생성해주는 **DBMS 내부의 핵심 엔진**

- 실행계획(Execution Plan) : 옵티마이저가 생성한 SQL 처리 경로

**✔ 옵티마이저 유형**

|비교|규칙기반 옵티마이저(RBO)|비용기반 옵티마이저(CBD)|
|--|--|--|
|개념|통계 정보가 없는 상태에서 사전 등록된 규칙에 따라 질의 실행 계획을 선택하는 옵티마이저|통계 정보로부터 모든 접근 경로를 고려한 질의실행 계획을 선택하는 옵티마이저|
|핵심|규칙(우선 순위)기반|비용(수행 시간)기반|
|평가기준|인덱스 구조, 연산자, 조건절 형태 등|레코드 개수, 블록 개수, 평균 행 길이, 컬럼 값의 수, 컬럼 값 분포, 인덱스 높이, 클러스터링 팩터 등|
|장점|사용자(개발자 또는 DBA)가 원하는 처리경로로 유도하기 쉬움|옵티마이저의 이해도가 낮아도 성능보장 가능(기본설정)|

- 요즘 DB는 비용기반 옵티마이저(CBD)를 많이 쓴다.

**✔ SQL 수행과정 내 옵티마이저 역할**

쿼리 변환 : SQL을 좀 더 일반적이고 표준화된 형태로 변환

비용 산정 : 쿼리 명령어 각 단계의 선택도 카디널리티, 비용을 계산, 궁극적으로 실행 계획 전체에 대한 총비용 계산

계획 생성 : 하나의 쿼리를 수행 시 후보군이 될만한 실행 계획들을 생성해내는 역할

### 힌트

SQL 성능 개선의 핵심 부분으로 옵티마이저의 실행 계획을 원하는 대로 변경할 수 있게 한다.

옵티마이저가 항상 최선의 실행 계획을 수립할 수 없어 명시적인 힌트를 통해 실행계획을 변경한다.

```sql
SELECT /*+ RULE */ ENAME, SAL
FROM EMP
WHERE EMPNO >9000;
```

**✔ 힌트 종류**

```sql

/*+ RULE */  -- 규칙 기반접근 방식

/*+ CHOOSE */ -- 오라클 옵티마이저 디폴트 값에 따름

/*+ INDEX(테이블명 인덱스명) */  -- 저장된 인덱스를 강제적으로 사용하도록 지정

/*+ USE_HASH(테이블명) */ -- 지정된 테이블들의 조인이 Hash Join 형식으로 일어나도록 유도

/*+ USE_MERGE(테이블명) */ -- 지정된 테이블들의 조인이 Sort Merge 형식으로 일어나도록 유도

/*+ USE_NL(테이블명) */ -- 지정된 테이블들의 조인이 Nested_pop 형식으로 일어나도록 유도
```

### SQL문 재구성

```
1. 특정 값 지정 (<,> 가 아닌 =)

2. 별도의 SQL 사용

3. 힌트 사용

4. HAVING 미사용

5. 인덱스만 질의 사용
```

###  인덱스 재구성

```
1. 자주쓰는 컬럼 산정

2. SORT 명령어 생략

3. 분포도를 고려

4. 변경 적은 컬럼 선정

5. 결합 인덱스 사용
```